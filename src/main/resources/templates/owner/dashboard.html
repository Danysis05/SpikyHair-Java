<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión Propietario - SpikyHair</title>
  <link rel="icon" type="image/x-icon" th:href="@{/uploads/favicon.png}">

  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  
  <style>
      .panel { display: none; opacity: 0; transition: opacity 0.3s ease; }
      .panel.active { display: block; opacity: 1; }
      .hidden { display: none !important; }
  </style>
</head>

<body>
  
  <div class="sidebar">
    <div class="logo">
      <img src="/uploads/Logo.png" alt="Logo" loading="lazy">
      SPIKYHAIR
    </div>
    <ul class="nav">
      <li onclick="navigate('servicios')" id="nav-servicios">Servicios</li>
      <li onclick="navigate('reservas')" id="nav-reservas">Reservas</li>
      <li onclick="navigate('estilistas')" id="nav-estilistas">Estilistas</li>
      <li onclick="navigate('reseñas')" id="nav-reseñas">Reseñas</li>
      <li onclick="navigate('peluqueria')" id="nav-peluqueria">Tu Salón</li>
    </ul>
  </div>

  <div class="main">
    
    <div class="header">
        <button class="btn-hamburger" onclick="toggleSidebar()">
            <i class="fa-solid fa-bars"></i>
        </button>
      <div>
        <h1>Bienvenido, Propietario</h1>
        <p th:text="${usuario.nombre}">Usuario</p>
      </div>
      <div class="user-actions">
        <a href="#" id="perfilBtn" title="Mi Perfil Personal"><i class="fa-solid fa-user"></i></a>
        <form th:action="@{/logout}" method="post" style="display:inline;">
          <button type="submit" class="logout-button" title="Cerrar Sesión"><i class="fa-solid fa-right-from-bracket"></i></button>
        </form>
      </div>
    </div>

    <div class="mensajes-csv" style="margin-top: 20px; width: 90%; max-width: 800px; margin: 20px auto;">
        <div th:if="${success}" class="alert alert-success" style="background: #28a745; color: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
            <i class="fa fa-check-circle"></i> <span th:text="${success}"></span>
        </div>
        <div th:if="${warning}" class="alert alert-warning" style="background: #f0ad4e; color: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
            <i class="fa fa-exclamation-triangle"></i> <span th:text="${warning}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger" style="background: #d93b3b; color: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
            <i class="fa fa-times-circle"></i> <span th:text="${error}"></span>
        </div>
    </div>
    <div id="mensajes" class="mensajes-csv" 
     style="margin-top: 20px; width: 90%; max-width: 800px; margin: 20px auto;">
</div>


    <div id="panelContainer">

<div id="estilistas" class="panel panel-est">

    <h2 class="panel-est-title">Gestión de Estilistas</h2>

    <!-- RESUMEN SUPERIOR -->
    <div class="panel-est-stats-box">
        <div class="panel-est-stats-card">
            <h5>Total Estilistas</h5>
            <div class="panel-est-stats-content">
                <i class="fas fa-cut"></i>
                <h2 th:text="${totalEstilistas}">0</h2>
            </div>
        </div>
    </div>

    <!-- ACCIONES SUPERIORES -->
    <div class="panel-est-actions">

        <button onclick="abrirModalEstilista()" class="panel-est-btn">
            <i class="fa fa-plus"></i> Nuevo Estilista
        </button>

        <form class="panel-est-import-form"
              th:action="@{/estilistas/importar-csv}"
              method="post"
              enctype="multipart/form-data">

            <label class="panel-est-import-label">
                <i class="fa fa-cloud-upload"></i> Importar CSV
                <input type="file" name="file"
                       accept=".csv" required
                       onchange="updateFileName('fileInputEst','fileNameEst')"
                       id="fileInputEst">
            </label>

            <span id="fileNameEst" class="panel-est-file-name"></span>

            <button type="submit" class="panel-est-send-btn">
                Subir Archivo
            </button>
        </form>

        <a th:href="@{/owners/pdf-Estilistas}" class="panel-est-btn pdf">
            <i class="fa fa-file-pdf"></i> PDF
        </a>
    </div>

    <!-- BUSCADOR -->
    <form th:action="@{/owners/dashboard}" method="get" class="panel-est-search">
        <input type="hidden" name="activeTab" value="estilistas">
        <input type="text" name="q" placeholder="Buscar estilista..." th:value="${q}">
        <button type="submit"><i class="fa fa-search"></i></button>
    </form>

    <!-- LISTA DE ESTILISTAS -->
    <div class="panel-est-grid">
        <div class="panel-est-card" th:each="e : ${estilistas}">

            <div class="panel-est-img-wrapper">
                <img th:if="${e.imagenPerfil != null}"
                     th:src="@{'/uploads/estilistas/' + ${e.imagenPerfil}}"
                     loading="lazy">

                <div class="panel-est-no-img" th:if="${e.imagenPerfil == null}">
                    <i class="fas fa-user"></i>
                </div>
            </div>

            <h3 th:text="${e.nombre}">Nombre</h3>
            <p class="panel-est-specialty" th:text="${e.especialidad}">Especialidad</p>

            <div class="panel-est-card-actions">
                <button class="panel-est-card-btn editar"
                        onclick="editarEstilista(this)"
                        th:data-id="${e.id}"
                        th:data-nombre="${e.nombre}"
                        th:data-especialidad="${e.especialidad}"
                        th:data-imagen="${e.imagenPerfil}">
                    <i class="fa-regular fa-pen-to-square"></i>
                </button>

                <button class="panel-est-card-btn eliminar"
                        onclick="eliminarEstilista(this)"
                        th:data-id="${e.id}">
                    <i class="fa-regular fa-trash-can"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- PAGINACIÓN -->
    <div class="panel-est-pagination" th:if="${totalPagesEstilistas > 0}">
        <a th:each="i : ${#numbers.sequence(0, totalPagesEstilistas - 1)}"
           th:classappend="${i == pageEstilistas} ? 'active' : ''"
           th:href="@{/owners/dashboard(pageEstilistas=${i}, activeTab='estilistas')}"
           class="panel-est-page-btn"
           th:text="${i + 1}"></a>
    </div>

</div>



      <div id="reseñas" class="panel panel-resenas">
        <h2>Reseñas de Clientes</h2>
<div class="usuarios-grid mb-4">

    <div class="card datos-card text-center p-3">
        <h5>
            <i class="fas fa-comment me-2"></i>
            Total Reseñas
        </h5>
        <h2 th:text="${totalResenas}">0</h2>
    </div>

    <div class="card datos-card text-center p-3">
        <h5>
            <i class="fas fa-star me-2"></i>
            Calificación Promedio
        </h5>
        <h2 th:text="${promedioPuntacion}">0</h2>
    </div>

</div>


        <a th:href="@{/owners/pdf-Resenas(q=${q})}" class="btn-pdf"><i class="fa fa-file-pdf"></i> Descargar PDF</a>
        <form th:action="@{/owners/dashboard}" method="get" class="buscador-universal">
            <input type="hidden" name="activeTab" value="reseñas">
            <input type="text" name="q" placeholder="Buscar reseñas..." th:value="${q}" />
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
        <div class="datos-container">
            <div class="usuarios-grid">
                <div class="usuario-card" th:each="r : ${resenas}">
                    <img th:src="@{${r.usuario.imagenPerfil != null ? '/uploads/' + r.usuario.imagenPerfil : '/images/default-avatar.png'}}" class="avatar-img" loading="lazy"/>
                    <h3 th:text="${r.usuario.nombre}">Usuario</h3>
                    <div class="stars" style="color: gold; margin: 5px 0;">
                        <span th:text="${r.puntuacion} + ' ★'"></span>
                    </div>
                    <p th:text="${r.comentario}" style="font-style: italic;">Comentario</p>
                </div>
            </div>
         <div class="pagination" th:if="${totalPagesResenas > 0}">
                <a th:each="i : ${#numbers.sequence(0, totalPagesResenas - 1)}"
                   th:classappend="${i == pageResenas} ? 'active' : ''"
                   th:href="@{/owners/dashboard(pageResenas=${i}, activeTab='reseñas')}"
                   class="pagination-btn" th:text="${i + 1}"></a>
        </div>
      </div>
        </div>

<div id="servicios" class="panel panel-servicios">

    <h2 class="serv-panel-title">Catálogo de Servicios</h2>

    <!-- FICHAS SUPERIORES -->
    <div class="serv-panel-stats-box">
        <div class="serv-panel-stat-card">
            <h5><i class="las la-store-alt"></i> Servicios Activos</h5>
            <h2 th:text="${totalServicios}">0</h2>
        </div>
    </div>

    <!-- ACCIONES SUPERIORES -->
    <div class="serv-panel-actions">

        <button onclick="abrirModalServicio()" class="serv-panel-btn-new">
            Nuevo Servicio
        </button>

        <form class="serv-panel-import-form" 
              th:action="@{/servicios/importar-csv}" 
              method="post" enctype="multipart/form-data">

            <label class="serv-panel-btn-import-label">
                <i class="fa fa-cloud-upload"></i> Importar CSV
                <input type="file" name="file" class="serv-panel-file-input"
                       accept=".csv" required
                       onchange="updateFileName('fileInputServicios','fileNameServicios')"
                       id="fileInputServicios">
            </label>

            <span id="fileNameServicios" class="serv-panel-file-name"></span>

            <button type="submit" class="serv-panel-btn-upload">
                Subir Archivo
            </button>
        </form>

        <a th:href="@{/owners/pdf-Servicios(q=${q})}" class="serv-panel-btn-pdf">
            <i class="fa fa-file-pdf"></i> PDF
        </a>
    </div>

    <!-- BUSCADOR -->
    <form th:action="@{/owners/dashboard}" method="get" class="serv-panel-search">
        <input type="hidden" name="activeTab" value="servicios">
        <input type="text" name="q" placeholder="Buscar servicio..." th:value="${q}">
        <button type="submit"><i class="fa fa-search"></i></button>
    </form>

    <!-- GRID -->
    <div class="serv-panel-grid">
        <div class="serv-panel-card" th:each="s : ${servicios}">

            <div class="serv-panel-img-wrap">
                <img th:src="@{/uploads/{img}(img=${s.imagen})}" loading="lazy"
                     onerror="this.parentElement.classList.add('no-img')">
            </div>

            <h3 th:text="${s.nombre}">Servicio</h3>

            <p class="serv-panel-duration">
                <i class="far fa-clock"></i>
                <span th:text="${s.duracion}"></span>
            </p>

            <p class="serv-panel-description" th:text="${s.descripcion}"></p>

            <h4 class="serv-panel-price" th:text="'$' + ${s.precio}">Precio</h4>

            <div class="serv-panel-actions-card">
                <button type="button" class="serv-panel-btn-edit"
                        onclick="editarServicio(this)"
                        th:data-id="${s.id}"
                        th:data-nombre="${s.nombre}"
                        th:data-duracion="${s.duracion}"
                        th:data-descripcion="${s.descripcion}"
                        th:data-precio="${s.precio}"
                        th:data-imagen="${s.imagen}">
                    <i class="fa-regular fa-pen-to-square"></i>
                </button>

                <a th:href="@{'/servicios/delete/' + ${s.id}}"
                   onclick="return confirm('¿Eliminar servicio?');"
                   class="serv-panel-btn-delete">
                    <i class="fa-regular fa-trash-can"></i>
                </a>
            </div>

        </div>
    </div>

    <!-- PAGINACIÓN -->
    <div class="serv-panel-pagination" th:if="${totalPagesServicios > 0}">
        <a th:each="i : ${#numbers.sequence(0, totalPagesServicios - 1)}"
           th:classappend="${i == pageServicios} ? 'active' : ''"
           th:href="@{/owners/dashboard(pageServicios=${i}, activeTab='servicios')}"
           class="serv-panel-pagination-btn"
           th:text="${i + 1}">
        </a>
    </div>

</div>


 <div id="reservas" class="panel">
    <h2>Listado de Reservas</h2>

    <!-- TARJETA SUPERIOR -->
    <div class="usuarios-grid mb-4">
        <div class="card text-center p-3">
            <h5>Reservas Totales</h5>
            <div class="content">
                <i class="las la-calendar-check"></i>
                <h2 th:text="${totalReservas}">0</h2>
            </div>
        </div>
    </div>

    <!-- ACCIONES SUPERIORES -->
    <div class="accionesSuperiores">
       
        <a th:href="@{/owners/pdf-Reservas(q=${q})}" class="btn-pdf">

            <i class="fa fa-file-pdf"></i> Descargar PDF
        </a>
    </div>

    <!-- BUSCADOR -->
    <form th:action="@{/owners/dashboard}" method="get" class="buscador-universal">
        <input type="hidden" name="activeTab" value="reservas">
        <input type="text" name="q" placeholder="Buscar por servicio, usuario, fecha..." th:value="${q}" />
        <button type="submit"><i class="fa fa-search"></i></button>
    </form>

    <!-- CONTENEDOR DE TARJETAS -->
    <div class="datos-container">
        <div class="usuarios-grid">

            <div class="usuario-card" th:each="r : ${reservas}">

               
                <i class="las la-calendar-check reservaIcon"></i>
                 <span class="reservaIcon"></span>
                <!-- Servicio -->
                <h3 th:text="${r.servicioNombre}">Servicio</h3>

                <!-- Fecha y hora -->
                <p>
                    <i class="far fa-calendar"></i>
                    <span th:text="${r.fecha}"></span>
                    <i class="far fa-clock" style="margin-left: 6px;"></i>
                    <span th:text="${r.hora}"></span>
                </p>

                <!-- Duración -->
                <p>
                    <i class="far fa-hourglass"></i>
                    <span th:text="${r.duracion}"></span>
                </p>

                <!-- Estilista -->
                <p th:if="${r.estilista != null}">
                    <i class="fas fa-user-tie"></i>
                    <span th:text="${r.estilista.nombre}"></span>
                </p>

                <!-- Usuario -->
                <p>
                    <i class="fas fa-user"></i>
                    <span th:text="${r.usuario.nombre}"></span>
                </p>

                <!-- Estado -->
                <select class="estado-select"
                        th:data-id="${r.id}"
                        th:value="${r.estado}"
                        onchange="cambiarEstadoReserva(this)">
                    <option value="PENDIENTE" 
                            th:selected="${r.estado == 'PENDIENTE'}">PENDIENTE</option>
                    <option value="REALIZADA" 
                            th:selected="${r.estado == 'REALIZADA'}">REALIZADA</option>
                </select>


                <!-- ACCIONES -->
                <div class="acciones">
                    <form th:action="@{'/reservas/eliminar/' + ${r.id}}" method="post"
                        onsubmit="return confirm('¿Estás seguro de que deseas cancelar esta reserva?');"
                        style="display:inline;">
                        <button type="submit" class="btn-eliminar">
                            <i class="fa-regular fa-trash-can"></i>
                        </button>
                    </form>

                </div>
            </div>

        </div>

        <!-- PAGINACIÓN -->
        <div class="pagination" th:if="${totalPagesReservas > 0}">
            <a th:each="i : ${#numbers.sequence(0, totalPagesReservas - 1)}"
               th:classappend="${i == pageReservas} ? 'active' : ''"
               th:href="@{/owners/dashboard(pageReservas=${i}, activeTab='reservas')}"
               class="pagination-btn"
               th:text="${i + 1}">
            </a>
        </div>
    </div>

</div>



      <div id="peluqueria" class="panel">

    <form th:action="@{/peluquerias/actualizar/{id}(id=${peluqueria.id})}"
          method="post" enctype="multipart/form-data" id="form-peluqueria">

        <!-- PORTADA -->
        <div class="pelu-header-bg">
            <img th:src="${peluqueria.imagenUrl != null} 
                        ? @{/uploads/peluquerias/{img}(img=${peluqueria.imagenUrl})} 
                        : @{/images/default-salon.png}"
                 alt="Portada del salón" loading="lazy">
        </div>

        <!-- TÍTULO -->
        <div class="pelu-header-title">
            <h1 th:text="${peluqueria.nombre}">Nombre Peluquería</h1>
        </div>

        <!-- GRID PRINCIPAL -->
        <div class="pelu-grid-layout">

            <!-- TARJETA DE FOTO -->
            <aside class="pelu-photo-card">
                <div class="pelu-avatar-wrapper">
                    <img id="preview-logo-salon"
                         th:src="${peluqueria.imagenUrl != null} 
                                  ? @{/uploads/peluquerias/{img}(img=${peluqueria.imagenUrl})} 
                                  : @{/images/default-salon.png}"
                         alt="Logo Peluquería" loading="lazy">

                    <label for="input-logo-salon" class="pelu-avatar-overlay">
                        <i class="fa-solid fa-camera fa-2x"></i>
                        <span>Cambiar</span>
                    </label>

                    <input type="file" name="archivoImagen" id="input-logo-salon"
                           hidden onchange="genericImagePreview(this, 'preview-logo-salon')">
                </div>

                <p class="pelu-photo-hint">Logo / Fachada del Salón</p>
            </aside>

            <!-- FORMULARIO -->
            <section class="pelu-form-card">

                <h3 class="pelu-form-title">Información de Contacto</h3>

                <div class="pelu-input-group">
                    <div>
                        <label class="pelu-label">Nombre</label>
                        <input type="text" name="nombre" th:value="${peluqueria.nombre}" class="pelu-input">
                    </div>
                    <div>
                        <label class="pelu-label">Dirección</label>
                        <input type="text" name="direccion" th:value="${peluqueria.direccion}" class="pelu-input" placeholder="Ej: Calle 123">
                    </div>
                    <div>
                        <label class="pelu-label">Teléfono</label>
                        <input type="text" name="telefono" th:value="${peluqueria.telefono}" class="pelu-input" placeholder="Ej: 300 123 4567">
                    </div>
                </div>

                <div class="pelu-input-group full">
                    <div>
                        <label class="pelu-label">Correo Electrónico</label>
                        <input type="email" name="email" th:value="${peluqueria.email}" class="pelu-input">
                    </div>
                </div>

                <h3 class="pelu-form-title">Configuración</h3>

                <div class="pelu-input-group">
                    <div>
                        <label class="pelu-label">Apertura</label>
                        <input type="time" name="horarioApertura" th:value="${peluqueria.horarioApertura}" class="pelu-input">
                    </div>
                    <div>
                        <label class="pelu-label">Cierre</label>
                        <input type="time" name="horarioCierre" th:value="${peluqueria.horarioCierre}" class="pelu-input">
                    </div>
                </div>

                <div class="pelu-input-group full">
                    <div>
                        <label class="pelu-label">Descripción</label>
                        <textarea name="descripcion" rows="4" class="pelu-input" th:text="${peluqueria.descripcion}"></textarea>
                    </div>
                </div>

                <button type="submit" class="pelu-btn-save">Guardar Cambios</button>

            </section>

        </div>

    </form>

</div>

     </div>
     </div> 
   <div id="modalPerfil" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="cerrarModal('modalPerfil')">&times;</span>

        <h2 class="modal-title">Mi Perfil</h2>

        <form action="/usuarios/guardar" method="post" enctype="multipart/form-data" class="perfil-form">
            
            <div class="preview-container">
                <img id="avatarPreviewUser"
                     th:src="@{${usuario.imagenPerfil != null ? '/uploads/' + usuario.imagenPerfil : '/images/default-avatar.png'}}"
                     class="imagen-preview" 
                     alt="Foto de perfil">
                
                <input type="file" id="imagenPerfilUser" name="imagen" accept="image/*" class="input-file-hidden" onchange="previewImage(event, '#avatarPreviewUser')">
                <label for="imagenPerfilUser" class="btn-upload">
                    <i class="fa-solid fa-camera"></i> Cambiar foto
                </label>
            </div>

            <input type="hidden" name="id" th:value="${usuario.id}">

            <div class="form-group">
                <label class="form-label">Nombre completo</label>
                <input type="text" name="nombre" th:value="${usuario.nombre}" class="form-input" required placeholder="Tu nombre">
            </div>


            <div class="form-group">
                <label class="form-label">Teléfono</label>
                <input type="text" name="telefono" th:value="${usuario.telefono}" class="form-input" placeholder="+57 300 123 4567">
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-cancelar" onclick="cerrarModal('modalPerfil')">Cancelar</button>
                <button type="submit" class="btn-guardar">Guardar Cambios</button>
            </div>
        </form>
    </div>
</div>


  <div id="modalServicio" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="cerrarModal('modalServicio')">&times;</span>
      <h2 class="modal-title">Gestión Servicio</h2>
      <form id="formServicio" method="post" enctype="multipart/form-data">
        <input type="hidden" name="id" id="servicioId" />
        <input type="hidden" name="peluqueria_id" th:value="${peluqueria.id}">
        
        <input type="text" name="nombre" id="nombreServicio" placeholder="Nombre" required class="form-input" />
        <input type="text" name="duracion" id="duracionServicio" placeholder="Duración (ej: 45 min)" required class="form-input" />
        <textarea name="descripcion" id="descripcionServicio" placeholder="Descripción" required class="form-input" style="height: 100px; resize: vertical;"></textarea>
        <input type="number" step="0.01" name="precio" id="precioServicio" placeholder="Precio" required class="form-input" />
        
        <label class="btn-guardar" style="margin-bottom: 15px; display: inline-block; cursor: pointer;">
          <i class="fa-solid fa-image"></i> Subir Imagen
          <input type="file" name="imagenFile" accept="image/*" style="display: none;" onchange="genericImagePreview(this, 'previewServicio')">
        </label>
        <img id="previewServicio" src="" class="imagen-preview hidden" style="max-height: 150px; display: block; margin: 0 auto;">

        <div class="form-buttons">
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="modalEstilista" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="cerrarModal('modalEstilista')">&times;</span>
      <h2 class="modal-title">Gestión Estilista</h2>
      <form id="formEstilista" method="post" enctype="multipart/form-data">
        <input type="hidden" name="id" id="estilistaId" />
        <input type="text" name="nombre" id="estilistaNombre" placeholder="Nombre" required class="form-input" />
        <input type="text" name="especialidad" id="estilistaEspecialidad" placeholder="Especialidad" required class="form-input" />
        
        <label class="btn-guardar" style="margin-bottom: 15px; display: inline-block; cursor: pointer;">
          <i class="fa-solid fa-image"></i> Subir Foto
          <input type="file" name="archivoImagen" accept="image/*" style="display: none;" onchange="genericImagePreview(this, 'previewEstilista')">
        </label>
        <img id="previewEstilista" src="" class="imagen-preview hidden" style="max-height: 150px; display: block; margin: 0 auto;">

        <div class="form-buttons">
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://kit.fontawesome.com/94f5bc3331.js" crossorigin="anonymous"></script>

  <script>
    /* ================= GESTIÓN DE PESTAÑAS ================= */
    function navigate(tabId) {
        // Ocultar todos los paneles
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        // Quitar clase active de navs
        document.querySelectorAll('.nav li').forEach(li => li.classList.remove('active'));
        
        // Activar el seleccionado (CON VALIDACIÓN DE SEGURIDAD)
        const selectedPanel = document.getElementById(tabId);
        if(selectedPanel) {
            selectedPanel.classList.add('active');
        } else {
            console.error("Panel no encontrado: " + tabId);
        }
        
        const selectedNav = document.getElementById('nav-' + tabId);
        if(selectedNav) selectedNav.classList.add('active');

        // Guardar estado
        localStorage.setItem('activeOwnerTab', tabId);
    }

    /* ================= PREVIEW DE IMAGENES UNIFICADO ================= */
    function genericImagePreview(input, imgId) {
        const preview = document.getElementById(imgId);
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    /* ================= MODALES ================= */
    function cerrarModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
    }

    // Modal Perfil Personal
    const perfilBtn = document.getElementById('perfilBtn');
    if(perfilBtn){
        perfilBtn.addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('modalPerfil').classList.add('show');
        });
    }

    // Modal Estilistas
    function abrirModalEstilista() {
        const form = document.getElementById('formEstilista');
        form.reset();
        form.action = "/estilistas/guardar";
        document.getElementById('estilistaId').value = "";
        const img = document.getElementById('previewEstilista');
        img.src = "";
        img.style.display = 'none';
        document.getElementById('modalEstilista').classList.add('show');
    }

    function editarEstilista(btn) {
        const form = document.getElementById('formEstilista');
        form.action = "/estilistas/guardar";
        document.getElementById('estilistaId').value = btn.dataset.id;
        document.getElementById('estilistaNombre').value = btn.dataset.nombre;
        document.getElementById('estilistaEspecialidad').value = btn.dataset.especialidad;
        
        const imgPreview = document.getElementById('previewEstilista');
        if(btn.dataset.imagen && btn.dataset.imagen !== 'null') {
            imgPreview.src = '/uploads/estilistas/' + btn.dataset.imagen;
            imgPreview.style.display = 'block';
        } else {
            imgPreview.style.display = 'none';
        }
        document.getElementById('modalEstilista').classList.add('show');
    }

    function eliminarEstilista(btn) {
        if(confirm('¿Eliminar estilista?')) window.location.href = '/estilistas/delete/' + btn.dataset.id;
    }

    // Modal Servicios
    function abrirModalServicio() {
        document.getElementById('formServicio').reset();
        document.getElementById('formServicio').action = '/servicios/create';
        document.getElementById('servicioId').value = '';
        document.getElementById('previewServicio').style.display = 'none';
        document.getElementById('modalServicio').classList.add('show');
    }

    function editarServicio(btn) {
        document.getElementById('servicioId').value = btn.dataset.id;
        document.getElementById('nombreServicio').value = btn.dataset.nombre;
        document.getElementById('duracionServicio').value = btn.dataset.duracion;
        document.getElementById('descripcionServicio').value = btn.dataset.descripcion;
        document.getElementById('precioServicio').value = btn.dataset.precio;
        document.getElementById('formServicio').action = '/servicios/update/' + btn.dataset.id;
        
        const imgPreview = document.getElementById('previewServicio');
        if(btn.dataset.imagen) {
            imgPreview.src = '/uploads/' + btn.dataset.imagen;
            imgPreview.style.display = 'block';
        } else {
            imgPreview.style.display = 'none';
        }
        document.getElementById('modalServicio').classList.add('show');
    }

    /* ================= UTILIDADES ================= */
    function updateFileName(inputId, spanId) {
        const input = document.getElementById(inputId);
        const span = document.getElementById(spanId);
        if(input.files.length > 0) span.textContent = input.files[0].name;
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
        // Recuperar pestaña activa o usar defecto
        const urlParams = new URLSearchParams(window.location.search);
        const tabParam = urlParams.get('activeTab');
        const savedTab = localStorage.getItem('activeOwnerTab');
        
        // Prioridad: URL > LocalStorage > Default
        if (tabParam) {
            navigate(tabParam);
        } else if (savedTab) {
            navigate(savedTab);
        } else {
            navigate('estilistas');
        }

        // Auto-dismiss alertas
setTimeout(() => {
    document.querySelectorAll('.alert').forEach(a => {
        a.classList.add('hide'); // activa la animación
        setTimeout(() => a.remove(), 500); // elimina del DOM después de que termine la transición
    });
}, 5000);

        
        // Cerrar modales click afuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }
    });
 function cambiarEstadoReserva(selectElement) {

    const reservaId = selectElement.getAttribute("data-id");

    fetch(`/reservas/cambiar-estado/${reservaId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {

        if (data.success) {
            selectElement.value = data.estado;

            mostrarMensaje("success", "Estado actualizado correctamente");

        } else {
            mostrarMensaje("error", data.error || "No se pudo cambiar el estado.");
        }
    })
    .catch(err => {
        console.error("Error:", err);
        mostrarMensaje("error", "Error al conectar con el servidor.");
    });
}

function mostrarMensaje(tipo, mensaje) {
    const contenedor = document.getElementById("mensajes");

    let color = "#28a745"; 
    let icon = "fa-check-circle";

    if (tipo === "warning") {
        color = "#f0ad4e";
        icon = "fa-exclamation-triangle";
    }
    if (tipo === "error") {
        color = "#d93b3b";
        icon = "fa-times-circle";
    }

    // Crear alerta dinámica
    const alerta = document.createElement("div");
    alerta.className = "alert";
    alerta.style.background = color;
    alerta.style.color = "white";
    alerta.style.padding = "15px";
    alerta.style.borderRadius = "8px";
    alerta.style.marginBottom = "10px";
    alerta.style.display = "flex";
    alerta.style.alignItems = "center";
    alerta.style.gap = "10px";
    alerta.innerHTML = `<i class="fa ${icon}"></i> <span>${mensaje}</span>`;

    contenedor.appendChild(alerta);

    // Después de 3 segundos, aplicar animación de salida
    setTimeout(() => {
        alerta.classList.add("fade-up");

        // Eliminar del DOM cuando termine la transición
        setTimeout(() => alerta.remove(), 800);
    }, 3000);
}
/* ==========================
   TOGGLE SIDEBAR - MOVIL
========================== */
function toggleSidebar() {
    const sidebar = document.querySelector(".sidebar");
    const overlay = document.getElementById("sidebarOverlay");

    sidebar.classList.toggle("show");
    overlay.classList.toggle("show");
}

  </script>
  <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
</body>
</html>